# 테이블오더 서비스 요구사항 문서

**프로젝트**: 테이블오더 서비스
**작성일**: 2026-02-09
**프로젝트 타입**: Greenfield

---

## 1. Intent Analysis Summary

### 1.1 사용자 요청
테이블오더 서비스를 구축하고 싶습니다. 다음 파일들에서 요구사항을 읽어주세요:
- requirements/table-order-requirements.md
- requirements/constraints.md

### 1.2 요청 분석
- **Request Type**: New Project - 테이블오더 서비스 신규 구축
- **Scope Estimate**: System-wide - 고객용 인터페이스, 관리자용 인터페이스, 서버 시스템, 데이터 저장소
- **Complexity Estimate**: Complex - 실시간 주문 모니터링(SSE), 세션 관리, 다중 사용자 인터페이스

---

## 2. 기술 스택 및 아키텍처

### 2.1 백엔드
- **언어/프레임워크**: Python + FastAPI
- **이유**: 빠른 개발, 간결한 코드, 비동기 지원, 자동 API 문서 생성

### 2.2 프론트엔드
- **프레임워크**: Vue.js
- **이유**: 학습 곡선 낮음, 유연함, 빠른 개발, 반응형 UI 구축 용이

### 2.3 데이터베이스
- **DBMS**: MySQL
- **ORM**: SQLAlchemy
- **마이그레이션**: ORM 자동 생성 (개발 편의성 우선)
- **이유**: 관계형 데이터베이스, 널리 사용됨, 안정적, ACID 보장

### 2.4 배포 환경
- **인프라**: AWS EC2 (단일 인스턴스)
- **구성**: MVP 테스트용 간단한 구성
- **향후 확장**: 트래픽 증가 시 ALB + Auto Scaling 고려

### 2.5 파일 저장소
- **이미지 저장**: AWS S3
- **용도**: 메뉴 이미지 저장

---

## 3. 기능 요구사항

### 3.1 고객용 기능 (Customer Features)

#### 3.1.1 테이블 태블릿 자동 로그인 및 세션 관리
**우선순위**: 필수 (MVP)

**기능**:
- 초기 설정 (관리자가 1회 수행):
  - 매장 식별자 입력
  - 테이블 번호 입력
  - 테이블 비밀번호 입력
  - 로그인 정보 로컬 저장
- 자동 로그인:
  - 저장된 정보로 자동 로그인
  - 16시간 세션 유지

**기술 구현**:
- JWT 토큰 기반 인증
- LocalStorage에 로그인 정보 저장
- 세션 만료 시 자동 재로그인

#### 3.1.2 메뉴 조회 및 탐색
**우선순위**: 필수 (MVP)

**기능**:
- 메뉴 화면이 기본 화면으로 표시
- 카테고리별 메뉴 분류 및 표시
- 메뉴 상세 정보 표시:
  - 메뉴명
  - 가격
  - 메뉴 설명
  - 메뉴 이미지
- 카테고리 간 빠른 이동

**UI/UX**:
- 카드 형태의 메뉴 레이아웃
- 터치 친화적인 버튼 크기 (최소 44x44px)
- 명확한 시각적 계층 구조

#### 3.1.3 장바구니 관리
**우선순위**: 필수 (MVP)

**기능**:
- 메뉴 추가/삭제
- 수량 조절 (증가/감소)
- 총 금액 실시간 계산
- 장바구니 비우기
- 로컬 저장 (페이지 새로고침 시에도 유지)

**데이터 관리**:
- 클라이언트 측 임시 저장 (LocalStorage)
- 서버 전송은 주문 확정 시에만 수행

#### 3.1.4 주문 생성
**우선순위**: 필수 (MVP)

**기능**:
- 주문 내역 최종 확인
- 주문 확정 버튼
- 주문 성공 플로우:
  - 주문 번호 표시
  - 장바구니 자동 비우기
  - 메뉴 화면으로 자동 리다이렉트
- 주문 실패 시 에러 메시지 표시 및 장바구니 유지

**주문 정보**:
- 매장 식별 정보
- 테이블 식별 정보
- 주문 메뉴 목록 (메뉴명, 수량, 단가)
- 총 주문 금액
- 세션 ID (테이블 세션 추적용)

#### 3.1.5 주문 내역 조회
**우선순위**: 필수 (MVP)

**기능**:
- 주문 시간 순 정렬
- 주문별 상세 정보 표시:
  - 주문 번호
  - 주문 시각
  - 주문 메뉴 및 수량
  - 주문 금액
  - 주문 상태 (대기중/준비중/완료)
- 주문 상태 실시간 업데이트 (선택사항)

**데이터 필터링**:
- 현재 테이블 세션 주문만 표시
- 매장 이용 완료 처리된 주문은 제외
- 페이지네이션 또는 무한 스크롤

### 3.2 관리자용 기능 (Admin Features)

#### 3.2.1 매장 인증
**우선순위**: 필수 (MVP)

**기능**:
- 매장 식별자 입력
- 사용자명 및 비밀번호 입력
- 세션 관리:
  - 16시간 세션 유지
  - JWT 토큰 기반 인증
  - 브라우저 새로고침 시 세션 유지
  - 16시간 후 자동 로그아웃

**보안**:
- 비밀번호 bcrypt 해싱
- 로그인 시도 제한
- HTTPS 통신

#### 3.2.2 실시간 주문 모니터링
**우선순위**: 필수 (MVP)

**기능**:
- 주문 목록 실시간 업데이트 (Server-Sent Events)
- 그리드/대시보드 레이아웃:
  - 테이블별 카드 형태 표시
  - 각 테이블 카드에 총 주문액 표시
  - 최신 주문 n개 미리보기
- 주문별 상세 정보:
  - 테이블 번호
  - 주문 번호
  - 주문 시각
  - 주문 메뉴 및 수량 (축약)
  - 총 금액
- 주문 카드 클릭 시 전체 메뉴 목록 상세 보기
- 주문 상태 변경 (대기중/준비중/완료)
- 신규 주문 시각적 강조 (색상 변경, 애니메이션)

**기술 구현**:
- FastAPI StreamingResponse 사용
- 2초 이내 주문 표시

**UI**:
- 그리드 형태의 테이블별 레이아웃
- 최신 주문 강조 표시
- 테이블별 필터링 기능

#### 3.2.3 테이블 관리
**우선순위**: 필수 (MVP)

**기능**:

**1. 테이블 태블릿 초기 설정**:
- 테이블 번호 및 테이블 비밀번호 설정
- 16시간 세션 생성
- 설정 정보 저장 및 자동 로그인 활성화

**2. 주문 삭제 (직권 수정)**:
- 특정 주문 삭제 버튼
- 확인 팝업 표시
- 주문 즉시 삭제
- 테이블 총 주문액 재계산
- 성공/실패 피드백

**3. 테이블 세션 처리**:
- 테이블 세션 시작(세션의 첫 주문) 및 종료 관리(테이블 이용 완료)
- 확인 팝업 표시
- 테이블 세션 종료(이용 완료) 시, 해당 세션의 주문 내역을 과거 이력으로 이동
- 테이블 세션 종료(이용 완료) 시, 테이블 현재 주문 목록 및 총 주문액 0으로 리셋
- 새 고객이 이전 주문 내역 없이 시작 가능
- 성공/실패 피드백

**4. 과거 주문 내역 조회**:
- "과거 내역" 버튼
- 테이블별 과거 주문 목록 표시 (시간 역순)
- 각 주문 정보: 주문 번호, 시각, 메뉴 목록, 총 금액, 매장 이용 완료 시각
- 날짜 필터링 기능
- "닫기" 버튼으로 대시보드 복귀

**데이터 관리**:
- 주문 이력 데이터베이스 저장 (OrderHistory 테이블)
- 세션 ID로 주문 그룹화
- 완료 시각 기록

#### 3.2.4 메뉴 관리
**우선순위**: 필수 (MVP) - **변경됨**

**기능**:
- 메뉴 조회 (카테고리별)
- 메뉴 등록:
  - 메뉴명
  - 가격
  - 설명
  - 카테고리
  - 이미지 업로드 (S3)
- 메뉴 수정
- 메뉴 삭제
- 메뉴 노출 순서 조정

**이미지 업로드**:
- 애플리케이션 내 업로드 기능 구현
- S3에 이미지 저장
- 이미지 URL을 데이터베이스에 저장

**데이터 검증**:
- 필수 필드 검증
- 가격 범위 검증

---

## 4. 비기능 요구사항 (NFR)

### 4.1 성능
- **응답 시간**: 평균 100ms 이하 (목표)
- **동시 사용자**: 중규모 (50-200명)
- **데이터베이스 쿼리 최적화**: 인덱스 활용, N+1 쿼리 방지
- **캐싱**: 메뉴 데이터 캐싱 고려

### 4.2 확장성
- **초기 구성**: 단일 EC2 인스턴스
- **향후 확장**: ALB + Auto Scaling Group 고려
- **데이터베이스**: 읽기 복제본 추가 고려

### 4.3 보안
- **인증**: JWT 토큰 기반
- **비밀번호**: bcrypt 해싱
- **통신**: HTTPS
- **CORS**: 적절한 CORS 설정
- **입력 검증**: 모든 사용자 입력 검증

### 4.4 가용성
- **세션 유지**: 16시간
- **에러 처리**: 명확한 에러 메시지
- **로깅**: 주요 이벤트 로깅

### 4.5 데이터 관리
- **데이터 보관**: 6개월
- **백업**: 정기적인 데이터베이스 백업
- **데이터 삭제**: 6개월 이후 자동 삭제 또는 아카이빙

### 4.6 사용성
- **반응형 디자인**: 태블릿 화면 최적화
- **터치 친화적**: 최소 44x44px 버튼
- **직관적 UI**: 명확한 네비게이션

---

## 5. 데이터 모델

### 5.1 주요 엔티티

#### Store (매장)
- store_id (PK)
- store_name
- store_identifier (unique)
- admin_username
- admin_password_hash
- created_at
- updated_at

#### Table (테이블)
- table_id (PK)
- store_id (FK)
- table_number
- table_password_hash
- current_session_id
- created_at
- updated_at

#### TableSession (테이블 세션)
- session_id (PK)
- table_id (FK)
- session_start_time
- session_end_time
- is_active
- created_at
- updated_at

#### Category (카테고리)
- category_id (PK)
- store_id (FK)
- category_name
- display_order
- created_at
- updated_at

#### Menu (메뉴)
- menu_id (PK)
- store_id (FK)
- category_id (FK)
- menu_name
- price
- description
- image_url
- display_order
- is_available
- created_at
- updated_at

#### Order (주문)
- order_id (PK)
- store_id (FK)
- table_id (FK)
- session_id (FK)
- order_number
- total_amount
- order_status (대기중/준비중/완료)
- is_completed (테이블 이용 완료 여부)
- created_at
- updated_at

#### OrderItem (주문 항목)
- order_item_id (PK)
- order_id (FK)
- menu_id (FK)
- menu_name (스냅샷)
- quantity
- unit_price (스냅샷)
- subtotal
- created_at

#### OrderHistory (주문 이력)
- history_id (PK)
- order_id (FK)
- session_id (FK)
- completed_at
- archived_data (JSON)

---

## 6. API 엔드포인트 (개요)

### 6.1 고객용 API
- `POST /api/customer/auth/login` - 테이블 로그인
- `GET /api/customer/menus` - 메뉴 조회
- `POST /api/customer/orders` - 주문 생성
- `GET /api/customer/orders` - 주문 내역 조회

### 6.2 관리자용 API
- `POST /api/admin/auth/login` - 관리자 로그인
- `GET /api/admin/orders/stream` - 실시간 주문 모니터링 (SSE)
- `PATCH /api/admin/orders/{order_id}/status` - 주문 상태 변경
- `DELETE /api/admin/orders/{order_id}` - 주문 삭제
- `POST /api/admin/tables/{table_id}/complete` - 테이블 이용 완료
- `GET /api/admin/tables/{table_id}/history` - 과거 주문 내역
- `GET /api/admin/menus` - 메뉴 조회
- `POST /api/admin/menus` - 메뉴 등록
- `PUT /api/admin/menus/{menu_id}` - 메뉴 수정
- `DELETE /api/admin/menus/{menu_id}` - 메뉴 삭제
- `POST /api/admin/upload/image` - 이미지 업로드

---

## 7. 제외 기능 (구현하지 않음)

### 7.1 결제 관련
- 실제 결제 처리
- 결제 게이트웨이 연동
- 영수증 발행
- 환불 처리
- 포인트/쿠폰 시스템

### 7.2 인증 및 보안
- OAuth, SNS 로그인
- 다단계 인증 (2FA, OTP)

### 7.3 파일 및 컨텐츠 관리
- 이미지 리사이징/최적화 (S3에 원본 저장)
- 컨텐츠 관리 시스템
- 광고 기능

### 7.4 알림 시스템
- 푸시 알림
- SMS 알림
- 이메일 발송
- 소리/진동 알림

### 7.5 주방 기능
- 주문 내역 주방 전달
- 주방 식재료 재고 관리

### 7.6 고급 기능
- 데이터 분석 및 대시보드
- 매출 리포트 생성
- 재고 관리 시스템
- 직원 관리 및 권한 설정
- 예약 시스템
- 고객 리뷰 시스템
- 다국어 기능

### 7.7 외부 연동
- 배달 플랫폼 연동
- POS 시스템 연동
- 소셜 미디어 공유
- 지도 API
- 번역 API

---

## 8. 테스트 전략

### 8.1 테스트 범위
- **단위 테스트**: 핵심 비즈니스 로직
- **통합 테스트**: API 엔드포인트, 데이터베이스 연동
- **E2E 테스트**: 주요 사용자 플로우

### 8.2 테스트 도구
- **백엔드**: pytest, pytest-asyncio
- **프론트엔드**: Vitest, Vue Test Utils
- **E2E**: Playwright 또는 Cypress

### 8.3 테스트 커버리지 목표
- 핵심 비즈니스 로직: 80% 이상
- API 엔드포인트: 주요 엔드포인트 100%
- E2E: 주요 사용자 플로우 커버

---

## 9. 개발 우선순위

### Phase 1: 핵심 기능 (MVP)
1. 데이터베이스 스키마 설계 및 구현
2. 고객용 기능:
   - 테이블 로그인
   - 메뉴 조회
   - 장바구니 관리
   - 주문 생성
   - 주문 내역 조회
3. 관리자용 기능:
   - 관리자 인증
   - 실시간 주문 모니터링 (SSE)
   - 주문 상태 변경
   - 테이블 관리 (주문 삭제, 세션 종료)
   - 메뉴 관리 (CRUD + 이미지 업로드)

### Phase 2: 추가 기능 (향후)
1. 과거 주문 내역 조회
2. 성능 최적화
3. 고급 필터링 및 검색
4. 데이터 분석 기능

---

## 10. 배포 및 운영

### 10.1 배포 환경
- **서버**: AWS EC2 (단일 인스턴스)
- **데이터베이스**: AWS RDS MySQL 또는 EC2 내 MySQL
- **파일 저장소**: AWS S3
- **도메인**: Route 53 (선택사항)
- **SSL**: Let's Encrypt 또는 AWS Certificate Manager

### 10.2 모니터링
- **로깅**: Python logging, 파일 또는 CloudWatch
- **에러 추적**: 기본 로깅 (향후 Sentry 고려)
- **성능 모니터링**: 기본 메트릭 수집

### 10.3 백업
- **데이터베이스**: 일일 자동 백업
- **이미지**: S3 버전 관리 활성화

---

## 11. 프로젝트 구조 (예상)

```
table-order-service/
├── backend/
│   ├── app/
│   │   ├── api/
│   │   │   ├── customer/
│   │   │   └── admin/
│   │   ├── models/
│   │   ├── schemas/
│   │   ├── services/
│   │   ├── core/
│   │   └── main.py
│   ├── tests/
│   ├── requirements.txt
│   └── README.md
├── frontend/
│   ├── customer/
│   │   ├── src/
│   │   ├── public/
│   │   └── package.json
│   └── admin/
│       ├── src/
│       ├── public/
│       └── package.json
└── docs/
```

---

## 12. 성공 기준

### 12.1 기능적 성공 기준
- 고객이 테이블에서 메뉴를 조회하고 주문할 수 있음
- 관리자가 실시간으로 주문을 모니터링하고 관리할 수 있음
- 메뉴 관리 기능이 정상 작동함
- 테이블 세션이 올바르게 관리됨

### 12.2 비기능적 성공 기준
- API 응답 시간 평균 100ms 이하 (목표)
- 50-200명 동시 사용자 처리 가능
- 주요 기능에 대한 테스트 커버리지 80% 이상
- 16시간 세션 유지 안정성

### 12.3 사용자 경험 성공 기준
- 직관적인 UI로 별도 교육 없이 사용 가능
- 터치 친화적인 인터페이스
- 명확한 피드백 및 에러 메시지

---

**문서 버전**: 1.0
**최종 업데이트**: 2026-02-09
